{"ast":null,"code":"// chat-app.js\n// ÌîºÏã± Î∞©Ïñ¥ AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏: Gradio Client Í∏∞Î∞ò ÌîÑÎ°†Ìä∏ÏóîÎìú\n// Î™®Îìà(ESM) Ïä§ÌÅ¨Î¶ΩÌä∏. HTMLÏóêÎäî <script type=\"module\" src=\"./chat-app.js\"></script>Îßå ÎÑ£ÏúºÏÑ∏Ïöî.\n\nimport { Client } from \"https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js\";\n\n/** =========================\r\n * ÏÑúÎ≤Ñ/ÏóîÎìúÌè¨Ïù∏Ìä∏ ÏÑ§Ï†ï\r\n * ========================= */\nconst CONFIG = {\n  BASE_URL: \"https://2b3b80943a762565f3.gradio.live\",\n  API_NAME: \"/chat\",\n  SESSION_HASH: crypto.randomUUID()\n};\n\n/** =========================\r\n * ÌïòÏù¥ÌçºÌååÎùºÎØ∏ÌÑ∞ Í∏∞Î≥∏Í∞í\r\n * ========================= */\nconst DEFAULTS = {\n  system_prompt: \"You are a helpful assistant.\",\n  temperature: 0.3,\n  top_p: 0.9,\n  top_k: 40,\n  max_new_tokens: 512,\n  repetition_penalty: 1.05\n};\n\n/** =========================\r\n * DOM Ìó¨Ìçº\r\n * ========================= */\nconst $ = {\n  log: () => document.querySelector(\"#log\"),\n  input: () => document.querySelector(\"#msg\"),\n  send: () => document.querySelector(\"#send\"),\n  status: () => document.querySelector(\"#status\"),\n  ready: () => document.querySelector(\"#ready\"),\n  typing: () => document.querySelector(\"#typing-indicator\")\n};\nfunction nowTime() {\n  const now = new Date();\n  return now.toLocaleTimeString(\"ko-KR\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\"\n  });\n}\n\n/** =========================\r\n * Ï±ÑÌåÖ UI Î†åÎçîÎü¨\r\n * ========================= */\nclass ChatRenderer {\n  /** @param {HTMLElement} logEl */\n  constructor(logEl) {\n    this.logEl = logEl;\n  }\n  clear() {\n    this.logEl.innerHTML = \"\";\n  }\n\n  /** @typedef {{role: \"user\"|\"assistant\", content: string}} Message */\n  /**\r\n   * @param {Message[]} history\r\n   */\n  renderFromHistory(history) {\n    this.clear();\n    for (const m of history) {\n      this.appendBubble(m.role, m.content);\n    }\n  }\n\n  /**\r\n   * @param {\"user\"|\"assistant\"} role\r\n   * @param {string} content\r\n   */\n  appendBubble(role, content) {\n    const wrap = document.createElement(\"div\");\n    wrap.className = role === \"user\" ? \"message-wrapper user-wrapper\" : \"message-wrapper bot-wrapper\";\n    const avatar = document.createElement(\"div\");\n    avatar.className = role === \"user\" ? \"avatar user-avatar\" : \"avatar bot-avatar\";\n    avatar.innerHTML = role === \"user\" ? '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"/></svg>' : '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-3 12H7c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1s-.45 1-1 1zm0-3H7c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1s-.45 1-1 1zm0-3H7c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1s-.45 1-1 1z\"/></svg>';\n    const messageContainer = document.createElement(\"div\");\n    messageContainer.className = \"message-container\";\n    const bubble = document.createElement(\"div\");\n    bubble.className = role === \"user\" ? \"bubble user-bubble\" : \"bubble bot-bubble\";\n    bubble.textContent = content;\n    const time = document.createElement(\"div\");\n    time.className = \"timestamp\";\n    time.textContent = nowTime();\n    messageContainer.appendChild(bubble);\n    messageContainer.appendChild(time);\n    if (role === \"user\") {\n      wrap.appendChild(messageContainer);\n      wrap.appendChild(avatar);\n    } else {\n      wrap.appendChild(avatar);\n      wrap.appendChild(messageContainer);\n    }\n    this.logEl.appendChild(wrap);\n    requestAnimationFrame(() => wrap.classList.add(\"show\"));\n    this.logEl.scrollTop = this.logEl.scrollHeight;\n  }\n}\n\n/** =========================\r\n * Ï±ÑÌåÖ Ïï± Ïª®Ìä∏Î°§Îü¨\r\n * ========================= */\nclass ChatApp {\n  constructor() {\n    /** @type {import(\"@gradio/client\").Client|null} */\n    this.client = null;\n    /** @type {ReturnType<Client[\"submit\"]>|null} */\n    this.currentJob = null;\n    this.busy = false;\n    /** @type {{role:\"user\"|\"assistant\", content:string}[]} */\n    this.history = [];\n    this.renderer = new ChatRenderer($.log());\n\n    // DOMContentLoaded Ïù¥ÌõÑ/Ïù¥Ï†ÑÏóê Î™®Îëê Ï†ïÏÉÅ ÎèôÏûëÌïòÎèÑÎ°ù Ï≤òÎ¶¨\n    if (document.readyState === \"loading\") {\n      window.addEventListener(\"DOMContentLoaded\", () => this.mount());\n    } else {\n      this.mount();\n    }\n  }\n  mount() {\n    this.bindEvents();\n    this.init();\n  }\n  bindEvents() {\n    // Textarea auto-height\n    $.input().addEventListener(\"input\", () => {\n      $.input().style.height = \"auto\";\n      $.input().style.height = Math.min($.input().scrollHeight, 120) + \"px\";\n    });\n\n    // Enter to send\n    $.input().addEventListener(\"keydown\", e => {\n      if (e.key === \"Enter\" && !e.shiftKey) {\n        e.preventDefault();\n        this.send();\n      }\n    });\n\n    // Button click to send\n    $.send().addEventListener(\"click\", () => this.send());\n  }\n  async init() {\n    try {\n      this.updateReady(\"‚è≥ Ïó∞Í≤∞ Ï§ë...\", false);\n      this.client = await Client.connect(CONFIG.BASE_URL, {\n        events: [\"data\", \"status\"]\n      });\n      this.updateReady(\"Ïó∞Í≤∞Îê®\", true);\n      this.updateStatus(\"Ïò®ÎùºÏù∏\");\n\n      // ÌôòÏòÅ Î©îÏãúÏßÄ\n      setTimeout(() => {\n        this.history.push({\n          role: \"assistant\",\n          content: \"ÏïàÎÖïÌïòÏÑ∏Ïöî! ÌîºÏã± Î∞©Ïñ¥ AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ÏûÖÎãàÎã§. ÏùòÏã¨Ïä§Îü¨Ïö¥ Î©îÏãúÏßÄÎÇò ÎßÅÌÅ¨Í∞Ä ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† ÏßàÎ¨∏Ìï¥Ï£ºÏÑ∏Ïöî. üõ°Ô∏è\"\n        });\n        this.renderer.renderFromHistory(this.history);\n        $.input().focus();\n      }, 300);\n    } catch (err) {\n      console.error(err);\n      this.updateReady(\"Ïó∞Í≤∞ Ïã§Ìå®\", false, true);\n      this.updateStatus(\"Ïò§ÌîÑÎùºÏù∏\");\n    }\n  }\n  updateReady(text, online, isError = false) {\n    $.ready().innerHTML = `<span class=\"status-dot ${online ? \"online\" : \"offline\"}\"></span> ${text}`;\n    if (isError) $.status().textContent = \"Ïò§ÌîÑÎùºÏù∏\";\n  }\n  updateStatus(text, generating = false) {\n    $.status().textContent = text;\n    $.status().classList.toggle(\"generating\", generating);\n  }\n  showTyping(show) {\n    if ($.typing()) $.typing().style.display = show ? \"flex\" : \"none\";\n  }\n  setBusy(b) {\n    this.busy = b;\n    this.showTyping(b);\n    $.send().disabled = b;\n    $.send().classList.toggle(\"disabled\", b);\n    this.updateStatus(b ? \"ÎãµÎ≥Ä ÏÉùÏÑ± Ï§ë\" : \"Ïò®ÎùºÏù∏\", b);\n  }\n  finishReset() {\n    this.setBusy(false);\n    $.input().focus();\n    this.currentJob = null;\n  }\n\n  /** Ï†ÑÏÜ° Î°úÏßÅ */\n  async send() {\n    var _this$currentJob;\n    if (this.busy) return;\n    const text = $.input().value.trim();\n    if (!text) return;\n    if (!this.client) {\n      alert(\"ÏÑúÎ≤Ñ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.\");\n      return;\n    }\n    const preHistory = this.history.slice();\n    this.history.push({\n      role: \"user\",\n      content: text\n    });\n    this.renderer.renderFromHistory(this.history);\n    $.input().value = \"\";\n    $.input().style.height = \"auto\";\n\n    // ÏßÑÌñâ Ï§ë Ïä§Ìä∏Î¶º Ï§ëÎã®\n    if ((_this$currentJob = this.currentJob) !== null && _this$currentJob !== void 0 && _this$currentJob.cancel) {\n      try {\n        this.currentJob.cancel();\n      } catch {\n        /* no-op */\n      }\n    }\n    this.setBusy(true);\n    try {\n      this.currentJob = this.client.submit(CONFIG.API_NAME, [text,\n      // user msg\n      preHistory,\n      // history Ï†ÑÎã¨\n      DEFAULTS.system_prompt, DEFAULTS.temperature, DEFAULTS.top_p, DEFAULTS.top_k, DEFAULTS.max_new_tokens, DEFAULTS.repetition_penalty], {\n        session_hash: CONFIG.SESSION_HASH\n      });\n      for await (const ev of this.currentJob) {\n        if (ev.type === \"status\") {\n          var _ref, _ref2, _ev$stage, _ev$status, _ev$status2;\n          const stage = (_ref = (_ref2 = (_ev$stage = ev.stage) !== null && _ev$stage !== void 0 ? _ev$stage : (_ev$status = ev.status) === null || _ev$status === void 0 ? void 0 : _ev$status.stage) !== null && _ref2 !== void 0 ? _ref2 : (_ev$status2 = ev.status) === null || _ev$status2 === void 0 ? void 0 : _ev$status2.status) !== null && _ref !== void 0 ? _ref : \"\";\n          if (stage === \"complete\" || stage === \"error\") {\n            this.finishReset();\n            break;\n          }\n          continue;\n        }\n        if (ev.type === \"data\") {\n          const [chatState] = ev.data;\n          if (Array.isArray(chatState)) {\n            this.history = chatState;\n            this.renderer.renderFromHistory(this.history);\n          }\n        }\n      }\n    } catch (e) {\n      console.error(\"stream error:\", e);\n      this.updateStatus(\"Ïò§Î•ò Î∞úÏÉù\");\n    } finally {\n      this.finishReset();\n    }\n  }\n}","map":{"version":3,"names":["Client","CONFIG","BASE_URL","API_NAME","SESSION_HASH","crypto","randomUUID","DEFAULTS","system_prompt","temperature","top_p","top_k","max_new_tokens","repetition_penalty","$","log","document","querySelector","input","send","status","ready","typing","nowTime","now","Date","toLocaleTimeString","hour","minute","ChatRenderer","constructor","logEl","clear","innerHTML","renderFromHistory","history","m","appendBubble","role","content","wrap","createElement","className","avatar","messageContainer","bubble","textContent","time","appendChild","requestAnimationFrame","classList","add","scrollTop","scrollHeight","ChatApp","client","currentJob","busy","renderer","readyState","window","addEventListener","mount","bindEvents","init","style","height","Math","min","e","key","shiftKey","preventDefault","updateReady","connect","events","updateStatus","setTimeout","push","focus","err","console","error","text","online","isError","generating","toggle","showTyping","show","display","setBusy","b","disabled","finishReset","_this$currentJob","value","trim","alert","preHistory","slice","cancel","submit","session_hash","ev","type","_ref","_ref2","_ev$stage","_ev$status","_ev$status2","stage","chatState","data","Array","isArray"],"sources":["C:/Users/Cheol/Desktop/front_end/src/pages/SimulationPage.js"],"sourcesContent":["// chat-app.js\r\n// ÌîºÏã± Î∞©Ïñ¥ AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏: Gradio Client Í∏∞Î∞ò ÌîÑÎ°†Ìä∏ÏóîÎìú\r\n// Î™®Îìà(ESM) Ïä§ÌÅ¨Î¶ΩÌä∏. HTMLÏóêÎäî <script type=\"module\" src=\"./chat-app.js\"></script>Îßå ÎÑ£ÏúºÏÑ∏Ïöî.\r\n\r\nimport { Client } from \"https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js\";\r\n\r\n/** =========================\r\n * ÏÑúÎ≤Ñ/ÏóîÎìúÌè¨Ïù∏Ìä∏ ÏÑ§Ï†ï\r\n * ========================= */\r\nconst CONFIG = {\r\n  BASE_URL: \"https://2b3b80943a762565f3.gradio.live\",\r\n  API_NAME: \"/chat\",\r\n  SESSION_HASH: crypto.randomUUID(),\r\n};\r\n\r\n/** =========================\r\n * ÌïòÏù¥ÌçºÌååÎùºÎØ∏ÌÑ∞ Í∏∞Î≥∏Í∞í\r\n * ========================= */\r\nconst DEFAULTS = {\r\n  system_prompt: \"You are a helpful assistant.\",\r\n  temperature: 0.3,\r\n  top_p: 0.9,\r\n  top_k: 40,\r\n  max_new_tokens: 512,\r\n  repetition_penalty: 1.05,\r\n};\r\n\r\n/** =========================\r\n * DOM Ìó¨Ìçº\r\n * ========================= */\r\nconst $ = {\r\n  log: () => document.querySelector(\"#log\"),\r\n  input: () => document.querySelector(\"#msg\"),\r\n  send: () => document.querySelector(\"#send\"),\r\n  status: () => document.querySelector(\"#status\"),\r\n  ready: () => document.querySelector(\"#ready\"),\r\n  typing: () => document.querySelector(\"#typing-indicator\"),\r\n};\r\n\r\nfunction nowTime() {\r\n  const now = new Date();\r\n  return now.toLocaleTimeString(\"ko-KR\", { hour: \"2-digit\", minute: \"2-digit\" });\r\n}\r\n\r\n/** =========================\r\n * Ï±ÑÌåÖ UI Î†åÎçîÎü¨\r\n * ========================= */\r\nclass ChatRenderer {\r\n  /** @param {HTMLElement} logEl */\r\n  constructor(logEl) {\r\n    this.logEl = logEl;\r\n  }\r\n\r\n  clear() {\r\n    this.logEl.innerHTML = \"\";\r\n  }\r\n\r\n  /** @typedef {{role: \"user\"|\"assistant\", content: string}} Message */\r\n  /**\r\n   * @param {Message[]} history\r\n   */\r\n  renderFromHistory(history) {\r\n    this.clear();\r\n    for (const m of history) {\r\n      this.appendBubble(m.role, m.content);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {\"user\"|\"assistant\"} role\r\n   * @param {string} content\r\n   */\r\n  appendBubble(role, content) {\r\n    const wrap = document.createElement(\"div\");\r\n    wrap.className = role === \"user\" ? \"message-wrapper user-wrapper\" : \"message-wrapper bot-wrapper\";\r\n\r\n    const avatar = document.createElement(\"div\");\r\n    avatar.className = role === \"user\" ? \"avatar user-avatar\" : \"avatar bot-avatar\";\r\n    avatar.innerHTML =\r\n      role === \"user\"\r\n        ? '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"/></svg>'\r\n        : '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-3 12H7c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1s-.45 1-1 1zm0-3H7c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1s-.45 1-1 1zm0-3H7c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1s-.45 1-1 1z\"/></svg>';\r\n\r\n    const messageContainer = document.createElement(\"div\");\r\n    messageContainer.className = \"message-container\";\r\n\r\n    const bubble = document.createElement(\"div\");\r\n    bubble.className = role === \"user\" ? \"bubble user-bubble\" : \"bubble bot-bubble\";\r\n    bubble.textContent = content;\r\n\r\n    const time = document.createElement(\"div\");\r\n    time.className = \"timestamp\";\r\n    time.textContent = nowTime();\r\n\r\n    messageContainer.appendChild(bubble);\r\n    messageContainer.appendChild(time);\r\n\r\n    if (role === \"user\") {\r\n      wrap.appendChild(messageContainer);\r\n      wrap.appendChild(avatar);\r\n    } else {\r\n      wrap.appendChild(avatar);\r\n      wrap.appendChild(messageContainer);\r\n    }\r\n\r\n    this.logEl.appendChild(wrap);\r\n    requestAnimationFrame(() => wrap.classList.add(\"show\"));\r\n    this.logEl.scrollTop = this.logEl.scrollHeight;\r\n  }\r\n}\r\n\r\n/** =========================\r\n * Ï±ÑÌåÖ Ïï± Ïª®Ìä∏Î°§Îü¨\r\n * ========================= */\r\nclass ChatApp {\r\n  constructor() {\r\n    /** @type {import(\"@gradio/client\").Client|null} */\r\n    this.client = null;\r\n    /** @type {ReturnType<Client[\"submit\"]>|null} */\r\n    this.currentJob = null;\r\n    this.busy = false;\r\n    /** @type {{role:\"user\"|\"assistant\", content:string}[]} */\r\n    this.history = [];\r\n    this.renderer = new ChatRenderer($.log());\r\n\r\n    // DOMContentLoaded Ïù¥ÌõÑ/Ïù¥Ï†ÑÏóê Î™®Îëê Ï†ïÏÉÅ ÎèôÏûëÌïòÎèÑÎ°ù Ï≤òÎ¶¨\r\n    if (document.readyState === \"loading\") {\r\n      window.addEventListener(\"DOMContentLoaded\", () => this.mount());\r\n    } else {\r\n      this.mount();\r\n    }\r\n  }\r\n\r\n  mount() {\r\n    this.bindEvents();\r\n    this.init();\r\n  }\r\n\r\n  bindEvents() {\r\n    // Textarea auto-height\r\n    $.input().addEventListener(\"input\", () => {\r\n      $.input().style.height = \"auto\";\r\n      $.input().style.height = Math.min($.input().scrollHeight, 120) + \"px\";\r\n    });\r\n\r\n    // Enter to send\r\n    $.input().addEventListener(\"keydown\", (e) => {\r\n      if (e.key === \"Enter\" && !e.shiftKey) {\r\n        e.preventDefault();\r\n        this.send();\r\n      }\r\n    });\r\n\r\n    // Button click to send\r\n    $.send().addEventListener(\"click\", () => this.send());\r\n  }\r\n\r\n  async init() {\r\n    try {\r\n      this.updateReady(\"‚è≥ Ïó∞Í≤∞ Ï§ë...\", false);\r\n      this.client = await Client.connect(CONFIG.BASE_URL, { events: [\"data\", \"status\"] });\r\n      this.updateReady(\"Ïó∞Í≤∞Îê®\", true);\r\n      this.updateStatus(\"Ïò®ÎùºÏù∏\");\r\n\r\n      // ÌôòÏòÅ Î©îÏãúÏßÄ\r\n      setTimeout(() => {\r\n        this.history.push({\r\n          role: \"assistant\",\r\n          content:\r\n            \"ÏïàÎÖïÌïòÏÑ∏Ïöî! ÌîºÏã± Î∞©Ïñ¥ AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ÏûÖÎãàÎã§. ÏùòÏã¨Ïä§Îü¨Ïö¥ Î©îÏãúÏßÄÎÇò ÎßÅÌÅ¨Í∞Ä ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† ÏßàÎ¨∏Ìï¥Ï£ºÏÑ∏Ïöî. üõ°Ô∏è\",\r\n        });\r\n        this.renderer.renderFromHistory(this.history);\r\n        $.input().focus();\r\n      }, 300);\r\n    } catch (err) {\r\n      console.error(err);\r\n      this.updateReady(\"Ïó∞Í≤∞ Ïã§Ìå®\", false, true);\r\n      this.updateStatus(\"Ïò§ÌîÑÎùºÏù∏\");\r\n    }\r\n  }\r\n\r\n  updateReady(text, online, isError = false) {\r\n    $.ready().innerHTML = `<span class=\"status-dot ${online ? \"online\" : \"offline\"}\"></span> ${text}`;\r\n    if (isError) $.status().textContent = \"Ïò§ÌîÑÎùºÏù∏\";\r\n  }\r\n\r\n  updateStatus(text, generating = false) {\r\n    $.status().textContent = text;\r\n    $.status().classList.toggle(\"generating\", generating);\r\n  }\r\n\r\n  showTyping(show) {\r\n    if ($.typing()) $.typing().style.display = show ? \"flex\" : \"none\";\r\n  }\r\n\r\n  setBusy(b) {\r\n    this.busy = b;\r\n    this.showTyping(b);\r\n    $.send().disabled = b;\r\n    $.send().classList.toggle(\"disabled\", b);\r\n    this.updateStatus(b ? \"ÎãµÎ≥Ä ÏÉùÏÑ± Ï§ë\" : \"Ïò®ÎùºÏù∏\", b);\r\n  }\r\n\r\n  finishReset() {\r\n    this.setBusy(false);\r\n    $.input().focus();\r\n    this.currentJob = null;\r\n  }\r\n\r\n  /** Ï†ÑÏÜ° Î°úÏßÅ */\r\n  async send() {\r\n    if (this.busy) return;\r\n    const text = $.input().value.trim();\r\n    if (!text) return;\r\n\r\n    if (!this.client) {\r\n      alert(\"ÏÑúÎ≤Ñ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.\");\r\n      return;\r\n    }\r\n\r\n    const preHistory = this.history.slice();\r\n    this.history.push({ role: \"user\", content: text });\r\n    this.renderer.renderFromHistory(this.history);\r\n    $.input().value = \"\";\r\n    $.input().style.height = \"auto\";\r\n\r\n    // ÏßÑÌñâ Ï§ë Ïä§Ìä∏Î¶º Ï§ëÎã®\r\n    if (this.currentJob?.cancel) {\r\n      try {\r\n        this.currentJob.cancel();\r\n      } catch {\r\n        /* no-op */\r\n      }\r\n    }\r\n\r\n    this.setBusy(true);\r\n\r\n    try {\r\n      this.currentJob = this.client.submit(\r\n        CONFIG.API_NAME,\r\n        [\r\n          text, // user msg\r\n          preHistory, // history Ï†ÑÎã¨\r\n          DEFAULTS.system_prompt,\r\n          DEFAULTS.temperature,\r\n          DEFAULTS.top_p,\r\n          DEFAULTS.top_k,\r\n          DEFAULTS.max_new_tokens,\r\n          DEFAULTS.repetition_penalty,\r\n        ],\r\n        { session_hash: CONFIG.SESSION_HASH }\r\n      );\r\n\r\n      for await (const ev of this.currentJob) {\r\n        if (ev.type === \"status\") {\r\n          const stage = ev.stage ?? ev.status?.stage ?? ev.status?.status ?? \"\";\r\n          if (stage === \"complete\" || stage === \"error\") {\r\n            this.finishReset();\r\n            break;\r\n          }\r\n          continue;\r\n        }\r\n\r\n        if (ev.type === \"data\") {\r\n          const [chatState] = ev.data;\r\n          if (Array.isArray(chatState)) {\r\n            this.history = chatState;\r\n            this.renderer.renderFromHistory(this.history);\r\n          }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error(\"stream error:\", e);\r\n      this.updateStatus(\"Ïò§Î•ò Î∞úÏÉù\");\r\n    } finally {\r\n      this.finishReset();\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}